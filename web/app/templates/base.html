<html>
        <head>
            <title>MSADS Console</title>
            <link rel="stylesheet" type="text/css" href="static/style.css">
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

            <script src="static/sorttable.js"></script>
            
        </head>
        <body>
     
            <div class="header">
              <div class="headrow">
                 
                  <div class="headcolumn" style="background-color: #064d43;flex:110px;">
                    <img style="width:100px;height: 100px;" src="/static/logo.png" />
                  </div>
                 
                  <div class="headcolumn" style="font-family:'Times New Roman', Times, serif; 
                  padding-top:25px;
                  background-color: #064d43;
                  color: #FFF;
                  font-size: 60px;
                  flex:200px;" >
                     Clarkson
                  </div>
                  <div class="headcolumn" style="background-color: #064d43;flex:100%" >
                 
                 </div>
                </div>
                <div style="width:100%;background-color: #ffce07;height: 5px;"></div>
          </div>
     


          <div id="content">
       
		{% block content %}{% endblock %}
         
        <h1>Quick Links</h1>
        <a href="https://mysql.clarksonmsda.org">PHP MyAdmin Login for MySQL*</a>
        <br>
        <a href="https://erdplus.com/#/">ERD Plus</a>
        <br>
        <br>

</div>


    <script type="application/javascript">

     
      /*
      var available = [];
      function add_tag(e)
      {
          tid = e.target.getAttribute("data-attr-tid");
          console.log(tid); 
          var xhttp = new XMLHttpRequest();
          xhttp.onload = function() {
          resp=JSON.parse(this.responseText);
          load_tags();
          }
        
        xhttp.open("GET", "tag?action=add&uid="+uid+"&tid="+tid, true);
        xhttp.send();
      }
      function delete_tag(e)
      {
        utid = e.target.getAttribute("data-attr-utid");
          console.log(tid);
          var xhttp = new XMLHttpRequest();
          xhttp.onload = function() {
          resp=JSON.parse(this.responseText);
          load_tags();
          }
        
        xhttp.open("GET", "tag?action=delete&uid="+uid+"&utid="+utid, true);
        xhttp.send();

      }

      function load_tags()
      {
        
        var xhttp = new XMLHttpRequest();
        xhttp.onload = function() {
          available=JSON.parse(this.responseText);
          tv = document.getElementById("available_tags");
          tv.innerHTML = "";
          available.forEach(function (item, index) {
            
            console.log(item, index);
            newTag = document.createElement("div");
            text = document.createTextNode(item.Name);
            newTag.appendChild(text);
            newTag.setAttribute("data-attr-tid",item.tid);
            newTag.addEventListener("click", add_tag);
            tv.appendChild(newTag);
            
          });
          
          }
        
        xhttp.open("GET", "tag?action=available&uid="+uid, true);
        xhttp.send();

        xhttp = new XMLHttpRequest();
        xhttp.onload = function() {
          available=JSON.parse(this.responseText);
          tv = document.getElementById("active_tags");
          tv.innerHTML = "";
          available.forEach(function (item, index) {
            
            console.log(item, index);
            newTag = document.createElement("div");
            text = document.createTextNode(item.Name);
            newTag.appendChild(text);
            newTag.setAttribute("data-attr-tid",item.tid);
            newTag.setAttribute("data-attr-utid",item.utid);
            newTag.addEventListener("click", delete_tag);
            tv.appendChild(newTag);
            
          });
          }
        
        xhttp.open("GET", "tag?uid="+uid, true);
        xhttp.send();

        
      }
      
      if (document.getElementById("uid_focus"))
      {
        uid = document.getElementById("uid_focus").getAttribute("value");
        window.onload = load_tags;
      }
      
*/

    function update_selection(e){

      if(e.target.checked == false)
      {
        clear_selection();
        return '';
      }
      var tids = [];
      var cbs = document.getElementsByClassName('filter_cb');
        Array.from(cbs).forEach(function (item, index) {
          if (item.checked)
            tids.push(item.getAttribute("value"));
        });

      //console.log(tids);
      xhttp = new XMLHttpRequest();
        xhttp.onload = function() {
          uids=JSON.parse(this.responseText);
          //console.log(uids);
          var cbs = document.getElementsByClassName('table_select');
            console.log(uids);
        Array.from(cbs).forEach(function (item, index) {
          uid=item.getAttribute("value");
          
              if (uids.indexOf(uid) >= 0)
              {
               
                item.checked = true;
              }
              else
              {
                item.checked = false;
              }
              
          });
          
          }
        var url = "tag?action=uids&tids[]="+tids.join('&tids[]=');
        xhttp.open("GET", url, true);
        //console.log(url);
        xhttp.send();



    }
    function add_tags(e)
    {
      var tids = [];
      var cbs = document.getElementsByClassName('filter_cb');
        Array.from(cbs).forEach(function (item, index) {
          if (item.checked)
            tids.push(item.getAttribute("value"));
        });
        var cbs = document.getElementsByClassName('table_select');
        var uids = [];
        Array.from(cbs).forEach(function (item, index) {
          if (item.checked)
          uids.push(item.getAttribute("value"));

        });

        xhttp = new XMLHttpRequest();
        xhttp.onload = function() {
          res=JSON.parse(this.responseText);
          clear_selection();
          //console.log(uids);
        }
        var url = "tag?action=tag_uids&uids[]="+uids.join('&uids[]=')+"&tids[]="+tids.join('&tids[]=');
        xhttp.open("GET", url, true);
        console.log(url);
        xhttp.send();


    }

    function del_tags(e)
    {
      var tids = [];
      var cbs = document.getElementsByClassName('filter_cb');
        Array.from(cbs).forEach(function (item, index) {
          if (item.checked)
            tids.push(item.getAttribute("value"));
        });
        var cbs = document.getElementsByClassName('table_select');
        var uids = [];
        Array.from(cbs).forEach(function (item, index) {
          if (item.checked)
            uids.push(item.getAttribute("value"));

        });

        xhttp = new XMLHttpRequest();
        xhttp.onload = function() {
          res=JSON.parse(this.responseText);
          clear_selection();
          update_selection();
          
          //console.log(uids);
        }
        var url = "tag?action=del_tag_uids&uids[]="+uids.join('&uids[]=')+"&tids[]="+tids.join('&tids[]=');
        xhttp.open("GET", url, true);
        console.log(url);
        xhttp.send();


    }
    function clear_selection()
    {
      var cbs = document.getElementsByClassName('filter_cb');
        Array.from(cbs).forEach(function (item, index) {
          item.checked = false;
        });
        var cbs = document.getElementsByClassName('table_select');

        Array.from(cbs).forEach(function (item, index) {
          item.checked = false;

        });
    }


    if (document.getElementById("filter_tags"))
      {
        var cbs = document.getElementsByClassName('filter_cb');
        Array.from(cbs).forEach(function (item, index) {
          item.addEventListener("click", update_selection);
        });

        var add_tag_btn = document.getElementById('add_tags');
        add_tag_btn.addEventListener("click", add_tags);

        var del_tag_btn = document.getElementById('del_tags');
        del_tag_btn.addEventListener("click", del_tags);

        var cbs = document.getElementsByClassName('table_select');
        Array.from(cbs).forEach(function (item, index) {

          //item.addEventListener("click", clear_selection);


        });
   

      }

      function download_table_as_csv(table_id, separator = ',') {
    // Select rows from table_id
    var rows = document.querySelectorAll('table#' + table_id + ' tr');
    // Construct csv
    var csv = [];
    for (var i = 0; i < rows.length; i++) {
        var row = [], cols = rows[i].querySelectorAll('td, th');
        for (var j = 0; j < cols.length; j++) {
            // Clean innertext to remove multiple spaces and jumpline (break csv)
            var data = cols[j].innerText.replace(/(\r\n|\n|\r)/gm, '').replace(/(\s\s)/gm, ' ')
            // Escape double-quote with double-double-quote (see https://stackoverflow.com/questions/17808511/properly-escape-a-double-quote-in-csv)
            data = data.replace(/"/g, '""');
            // Push escaped string
            row.push('"' + data + '"');
        }
        csv.push(row.join(separator));
    }
    var csv_string = csv.join('\n');
    // Download it
    var filename = 'export_' + table_id + '_' + new Date().toLocaleDateString() + '.csv';
    var link = document.createElement('a');
    link.style.display = 'none';
    link.setAttribute('target', '_blank');
    link.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv_string));
    link.setAttribute('download', filename);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

      
      (function () {
    const table = document.getElementById('cb_table');
    let lastInput = null;

    table.addEventListener('click', function (event) {
        const currInput = event.target;

        if (currInput.type !== 'checkbox') {
            return;
        }

        if (event.shiftKey && lastInput !== null && lastInput !== currInput) {
            const inputs = table.querySelectorAll('input[type="checkbox"]');

            lastInput.checked = currInput.checked;
            lastInput.dispatchEvent(new Event('change', {
                bubbles: true,
                cancelable: true
            }));

            let inBetween = false;
            inputs.forEach(function (input) {
                if (input === lastInput || input === currInput) {
                    inBetween = !inBetween;
                } else if (inBetween) {
                    input.checked = currInput.checked;
                    input.dispatchEvent(new Event('change', {
                        bubbles: true,
                        cancelable: true
                    }));
                }
            });
        }

        lastInput = currInput;
    }, {
        passive: true
    });
})();

      </script>

		</body>
    
    </html>